<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.1. Toy Example of MAS with Creamas &#8212; CC-MAS 2016 0.1a documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="CC-MAS 2016 0.1a documentation" href="index.html" />
    <link rel="up" title="4. Multi-Agent Systems" href="mas.html" />
    <link rel="next" title="4.2. Agents With Memory and Learning From Domain" href="mas_memory.html" />
    <link rel="prev" title="4. Multi-Agent Systems" href="mas.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="toy-example-of-mas-with-creamas">
<h1>4.1. Toy Example of MAS with Creamas<a class="headerlink" href="#toy-example-of-mas-with-creamas" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/assamite/cc-mas-course/blob/master/week2/toy_mas.py">(full code)</a></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>(Sat 12.11. 10.04) There was a mistake in the example codes considering
<code class="xref py py-meth docutils literal"><span class="pre">evaluate()</span></code> function and the number of elements it should return. There
are now two full code examples <code class="docutils literal"><span class="pre">toy_mas.py</span></code> and <code class="docutils literal"><span class="pre">toy_mas2.py</span></code> in the
repository. The version that works for you is depended on the version of
Creamas: if you have Creamas 0.1.1 then <code class="docutils literal"><span class="pre">toy_mas.py</span></code> should work, and
if you have Creamas 0.1.0 then <code class="docutils literal"><span class="pre">toy_mas2.py</span></code> should work. You can check
which version you currently have by typing <code class="docutils literal"><span class="pre">pip</span> <span class="pre">freeze</span></code> in the terminal while
your virtual environment is active.</p>
<p>The easiest way to get everything working is upgrading the Creamas and following
this example (and the full code <code class="docutils literal"><span class="pre">toy_mas.py</span></code>). You can upgrade you
Creamas 0.1.0 to 0.1.1 by executing <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--upgrade</span> <span class="pre">creamas</span></code> in the terminal.
If you are installing Creamas for the first time, then <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">creamas</span></code>
should automatically install you the latest version (0.1.1).</p>
<p class="last">This example is currently written for
Creamas 0.1.1, however there is very little that is changed between the two example
code version. The differences are in how many elements <code class="xref py py-meth docutils literal"><span class="pre">evaluate()</span></code>
returns. With creamas==0.1.0, the evaluation function should return <strong>one</strong> element.
With creamas==0.1.1, the evaluation function should return <strong>two</strong> elements.
Changing the <code class="xref py py-meth docutils literal"><span class="pre">evaluate()</span></code> also forces some refactoring in <code class="xref py py-meth docutils literal"><span class="pre">invent()</span></code>
to reflect these changes.</p>
</div>
<p>In this example we will create a simple multi-agent system with
<a class="reference external" href="https://assamite.github.io/creamas">Creamas</a>. Creamas uses vocabulary typical
to MAS in CC: agents, environments, and artifacts. You can find an overview of
the library (which should be enough for this example) from the documentation,
but here are main points:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The focus of the agents in the Creamas is on artifact creation.</li>
<li>Environment is used for establishing communication route between agents.
(You can also subclass it to have some additional responsibilities.)</li>
<li>Artifacts are light wrappers for (any kind of) objects, where you can
store some metadata about the artifact, e.g. its creator, evaluations
and framings.</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Creamas should be installed in your virtual environment. If you get any
import errors while running the code, use <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">creamas==0.1.1</span></code>.</p>
</div>
<div class="section" id="parsing-the-vocabulary">
<h2>4.1.1. Parsing the Vocabulary<a class="headerlink" href="#parsing-the-vocabulary" title="Permalink to this headline">¶</a></h2>
<p>Our goal is to make agents which generate (random) words, and evaluate them
based on their vocabulary. In this example all the agents will have the same
vocabulary, which is generally not desirable, but will do for the sake of the
example. To generate the vocabulary, we will define two straightforward parsing
functions:</p>
<dl class="function">
<dt id="toy_mas.parse_words">
<code class="descclassname">toy_mas.</code><code class="descname">parse_words</code><span class="sig-paren">(</span><em>filename</em>, <em>encoding</em>, <em>word_pattern</em>, <em>wlen_limits</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toy_mas.html#parse_words"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toy_mas.parse_words" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse acceptable words from the file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Path to the file to parse</li>
<li><strong>encoding</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Encoding of the file (most probably &#8216;utf8&#8217;)</li>
<li><strong>word_pattern</strong> &#8211; Compiled regex for acceptable words</li>
<li><strong>wlen_limits</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#tuple" title="(in Python v2.7)"><em>tuple</em></a>) &#8211; Length limits for the acceptable words</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Acceptable words as a list (may contain multiple entries of the same
word).</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="toy_mas.frequent_words">
<code class="descclassname">toy_mas.</code><code class="descname">frequent_words</code><span class="sig-paren">(</span><em>filename</em>, <em>encoding</em>, <em>word_pattern</em>, <em>wlen_limits</em>, <em>n=20</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toy_mas.html#frequent_words"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toy_mas.frequent_words" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the most frequent words from the given file.</p>
<p>The &#8216;word&#8217; is used loosely here as a word is anything the <code class="docutils literal"><span class="pre">parse_words</span></code>
function will recognize as a word.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; File to learn the words</li>
<li><strong>encoding</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Encoding of the file (most probably &#8216;utf8&#8217;)</li>
<li><strong>word_pattern</strong> &#8211; Compiled regex for acceptable words</li>
<li><strong>wlen_limits</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#tuple" title="(in Python v2.7)"><em>tuple</em></a>) &#8211; Length limits for the acceptable words</li>
<li><strong>n</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) &#8211; Number of words to return</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a list of the most common (n) words in the file</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>And here is the actual code for both of the functions (docstrings stripped):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">word_pattern</span><span class="p">,</span> <span class="n">wlen_limits</span><span class="p">):</span>
    <span class="c1"># Filter function to define which words are accepted.</span>
    <span class="k">def</span> <span class="nf">is_word</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">word_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wlen_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wlen_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="n">is_word</span><span class="p">(</span><span class="n">w</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="k">def</span> <span class="nf">frequent_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">word_pattern</span><span class="p">,</span> <span class="n">wlen_limits</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">parse_words</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">word_pattern</span><span class="p">,</span> <span class="n">wlen_limits</span><span class="p">)</span>
    <span class="c1"># Count the number of times each element appears in the list</span>
    <span class="n">ctr</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="n">common</span> <span class="o">=</span> <span class="n">ctr</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="c1"># return only the words, not their counts</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">common</span><span class="p">]</span>
</pre></div>
</div>
<p>We will use these two parsing functions in the next section where we actually
implement our agents.</p>
</div>
<div class="section" id="creating-an-agent-class">
<h2>4.1.2. Creating an Agent Class<a class="headerlink" href="#creating-an-agent-class" title="Permalink to this headline">¶</a></h2>
<p>Now we create a new agent class by subclassing the
base class <a class="reference external" href="https://assamite.github.io/creamas/agent.html">CreativeAgent</a>
from Creamas. <code class="docutils literal"><span class="pre">CreativeAgent</span></code> has a lot of predefined attributes, which we
will not touch in here. We will also create the initialization function
<code class="xref py py-func docutils literal"><span class="pre">__init__()</span></code>. The initialization function has to call its superclass&#8217;
initialization function so that all required attributes get initialized. In our
initialization function, we will define the acceptable words as a compiled regex
pattern and word limits, and then &#8220;learn&#8221; the vocabulary from a given file. Here
is the documentation for our <code class="xref py py-class docutils literal"><span class="pre">ToyAgent</span></code> (<code class="docutils literal"><span class="pre">env</span></code> is the environment for
the agent, which we will define later in the example):</p>
<dl class="class">
<dt id="toy_mas.ToyAgent">
<em class="property">class </em><code class="descclassname">toy_mas.</code><code class="descname">ToyAgent</code><span class="sig-paren">(</span><em>env</em>, <em>filename</em>, <em>encoding='utf8'</em>, <em>n=20</em>, <em>wlen_limits=(2</em>, <em>11)</em>, <em>chars='abcdefghijklmnopqrstuvwxyz'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toy_mas.html#ToyAgent"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toy_mas.ToyAgent" title="Permalink to this definition">¶</a></dt>
<dd><p>A sample agent implementation.</p>
<p>Agent invents new words be generating them at random and evaluating them
with respect to its own vocabulary.</p>
<p>Agent learns its vocabulary from the file given at initialization.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>env</strong> &#8211; subclass of <code class="xref py py-class docutils literal"><span class="pre">Environment</span></code></li>
<li><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Filename from which the words should be parsed.</li>
<li><strong>encoding</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Encoding of the file</li>
<li><strong>n</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) &#8211; The number of words the agent considers per <code class="xref py py-func docutils literal"><span class="pre">invent()</span></code></li>
<li><strong>wlen_limits</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#tuple" title="(in Python v2.7)"><em>tuple</em></a>) &#8211; (int, int)-tuple, acceptable word length limits</li>
<li><strong>chars</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; acceptable characters in the words</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>And here is the code (docstrings stripped)e:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ToyAgent</span><span class="p">(</span><span class="n">CreativeAgent</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">wlen_limits</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="n">chars</span><span class="o">=</span><span class="s1">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chars</span> <span class="o">=</span> <span class="n">chars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wlen_limits</span> <span class="o">=</span> <span class="n">wlen_limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">word_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;^\w+$&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="n">frequent_words</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                                    <span class="n">word_pattern</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">word_pattern</span><span class="p">,</span>
                                    <span class="n">wlen_limits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wlen_limits</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="generating-words">
<h2>4.1.3. Generating words<a class="headerlink" href="#generating-words" title="Permalink to this headline">¶</a></h2>
<p>As our aim is for a creative (well, at least generative) agent, we need a
function which generates us some words (or character strings). In this example
we will settle on generating random character strings from the <code class="docutils literal"><span class="pre">chars</span></code> given
at agent&#8217;s initialization time. To this end, our <code class="docutils literal"><span class="pre">generate</span></code> function is
very simple (N.B. this is actually a method inside the class <code class="docutils literal"><span class="pre">ToyAgent</span></code>, hence
the <code class="docutils literal"><span class="pre">self</span></code> parameter):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generate a new word.</span>

<span class="sd">    Word is generated by uniformly drawing from ``chars``. Word length is</span>
<span class="sd">    in ``wlen_limits``.</span>

<span class="sd">    :returns: a word wrapped as :class:`~creamas.core.artifact.Artifact`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">word_length</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">wlen_limits</span><span class="p">)</span>
    <span class="n">word</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chars</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">word_length</span><span class="p">)]</span>
    <span class="n">word</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
<p>Here it is important to see that the generated word is wrapped as
<a class="reference external" href="http://assamite.github.io/creamas/artifact.html">Artifact</a>,
which can hold some metadata considering the object. We will include some
metadata in the following sections, but for now it should be enough to know,
that the original object (in this case the string) can be accessed as <code class="docutils literal"><span class="pre">obj</span></code>
attribute of the artifact, i.e.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">artifact</span> <span class="o">=</span> <span class="n">Artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;blaa&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">artifact</span><span class="o">.</span><span class="n">obj</span>
<span class="go">&#39;blaa&#39;</span>
</pre></div>
</div>
<p>The domain of
the artifact is not relevant at this point. (It has to do with
automatic feature evaluation based on the rules the agent has, but currently
the functionality is not properly implemented.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Agents in Creamas should always pass each other <code class="docutils literal"><span class="pre">Artifact</span></code> instances (or
subclasses of it), for all the library&#8217;s functionalities to work.</p>
</div>
</div>
<div class="section" id="evaluating-words">
<h2>4.1.4. Evaluating Words<a class="headerlink" href="#evaluating-words" title="Permalink to this headline">¶</a></h2>
<p>Our agent is now capable of generating some random character strings, but has
no notion of value (or novelty or surprisingness). To evaluate our strings,
we will use the <code class="docutils literal"><span class="pre">vocab</span></code> which was learned from a file when the agent was
created, and <a class="reference external" href="https://en.wikipedia.org/wiki/Levenshtein_distance">Levenshtein distance</a>.
For the sake of our purposes, it is sufficient to know that the Levenshtein
distance computes the minimum number of edit operations by which one of the strings
can be changed to another. Here is our evaluation function&#8217;s documentation:</p>
<dl class="method">
<dt id="toy_mas.ToyAgent.evaluate">
<code class="descclassname">ToyAgent.</code><code class="descname">evaluate</code><span class="sig-paren">(</span><em>artifact</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toy_mas.html#ToyAgent.evaluate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toy_mas.ToyAgent.evaluate" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate given artifact with respect to the words the agent knows.</p>
<p>Actual evaluation formula for a string <span class="math">\(s\)</span> is:</p>
<div class="math">
\[e(s) = \max_{w \in \texttt{vocab}}\frac{1 - \texttt{lev}(s, w)}
{\max(|s|, |w|)},\]</div>
<p>where <span class="math">\(\texttt{lev}(s, w)\)</span> is the Levenshtein
distance between the two strings.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>artifact</strong> &#8211; <code class="xref py py-class docutils literal"><span class="pre">Artifact</span></code> to be evaluated</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">(evaluation, word)-tuple, containing both the evaluation and the
word giving the maximum evaluation</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>And its code (the code for the Levenshtein distance computation can be found from the full
code example, but it is not included here for clarity):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">artifact</span><span class="p">):</span>
    <span class="n">evaluation</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">evaluation_word</span> <span class="o">=</span> <span class="n">artifact</span><span class="o">.</span><span class="n">obj</span>
    <span class="n">matching_word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">:</span>
        <span class="n">lev</span> <span class="o">=</span> <span class="n">levenshtein</span><span class="p">(</span><span class="n">evaluation_word</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="n">mlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">evaluation_word</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)))</span>
        <span class="n">current_evaluation</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lev</span><span class="p">)</span> <span class="o">/</span> <span class="n">mlen</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_evaluation</span> <span class="o">&gt;</span> <span class="n">evaluation</span><span class="p">:</span>
            <span class="n">evaluation</span> <span class="o">=</span> <span class="n">current_evaluation</span>
            <span class="n">matching_word</span> <span class="o">=</span> <span class="n">word</span>
    <span class="k">return</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">matching_word</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is important for the <code class="xref py py-meth docutils literal"><span class="pre">evaluate()</span></code> method to return two elements
because of how the Creamas is built. The another element is so called
framing for the evaluation, but it can be left blank. If you do not need
the another element, put in its place <code class="docutils literal"><span class="pre">None</span></code>.</p>
</div>
</div>
<div class="section" id="inventing-new-words">
<h2>4.1.5. Inventing New Words<a class="headerlink" href="#inventing-new-words" title="Permalink to this headline">¶</a></h2>
<p>With generation and evaluation of words in place, we can move to inventing new
words. In this example we will simply try to create a number of words, and
select the one with the highest evaluation. However, it could be justified to,
e.g. start from a previous highly evaluated example and alter it and keep a list
of already invented words so that we do not invent the same words repeatedly.</p>
<p>Our <code class="docutils literal"><span class="pre">invent</span></code> function is very simple loop:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">invent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">best_artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
    <span class="n">max_evaluation</span><span class="p">,</span> <span class="n">match_word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">best_artifact</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
        <span class="n">evaluation</span><span class="p">,</span> <span class="n">m_word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">artifact</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">evaluation</span> <span class="o">&gt;</span> <span class="n">max_evaluation</span><span class="p">:</span>
            <span class="n">best_artifact</span> <span class="o">=</span> <span class="n">artifact</span>
            <span class="n">max_evaluation</span> <span class="o">=</span> <span class="n">evaluation</span>
            <span class="n">match_word</span> <span class="o">=</span> <span class="n">m_word</span>
    <span class="c1"># Add evaluation and framing to the artifact</span>
    <span class="n">best_artifact</span><span class="o">.</span><span class="n">add_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_evaluation</span><span class="p">,</span> <span class="n">fr</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;match&#39;</span> <span class="p">:</span> <span class="n">match_word</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">best_artifact</span>
</pre></div>
</div>
<p>Here, you can see that we add the evaluation and so called &#8216;framing&#8217; to the
artifact after we have selected the best artifact. The framing is something that
was/is taken into consideration when creating/observing the artifact. Our framing
is simply the word that created the best evaluation for our best artifact.</p>
<p>Now our agent is almost complete, however, as we want it to interact with other
agents, we will make some additions.</p>
</div>
<div class="section" id="voting">
<h2>4.1.6. Voting<a class="headerlink" href="#voting" title="Permalink to this headline">¶</a></h2>
<p>Our interaction model between the agents is a voting procedure. We run the system
in an iterative simulation where on each iteration:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Each agent produces a number of artifacts and selects the best one</li>
<li>Each agent adds its best artifact to candidate artifacts</li>
<li>Agents vote the winner from the candidates</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As all the agents in our example will have the same words (if given the
same file in initialization) in their vocabulary, it means that all agents
have the same evaluation formula. We will use this naive model just for the
example.</p>
</div>
<p>To run the simulation we will use
<a class="reference external" href="http://assamite.github.io/creamas/simulation.html">Simulation</a> class. All
agents that run inside the simulation must implement <code class="docutils literal"><span class="pre">act</span></code> function. For our
agents, we will simply call <code class="docutils literal"><span class="pre">invent</span></code> on every act and then add the invented
word to candidates of the environment:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">add_candidate</span><span class="p">(</span><span class="n">artifact</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">async</span></code> keyword before the function definition is of key importance here.
It tells Python that this function is supposed to be called inside an event
loop. We will not go very deeply into the asynchronicity during the course,
but if your code complains something about asyncio or event loop, you
probably have some kind of async-problems.</p>
</div>
<p>Next, we will define a subclass of
<a class="reference external" href="http://assamite.github.io/creamas/environment.html">Environment</a> where we
define only one function <code class="docutils literal"><span class="pre">vote</span></code>, which is used as a callback on every
simulation step:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ToyEnvironment</span><span class="p">(</span><span class="n">Environment</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="n">artifacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">perform_voting</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">artifacts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">accepted</span> <span class="o">=</span> <span class="n">artifacts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">artifacts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Vote winner by </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2"> (val=</span><span class="si">{}</span><span class="s2">)&quot;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accepted</span><span class="o">.</span><span class="n">creator</span><span class="p">,</span> <span class="n">accepted</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No vote winner!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear_candidates</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">vote</span></code> function performs the voting with a selected method (voting rule).
Here the method is to select the candidate with the best mean evaluation
across all the agents. Then we simply announce the winner for this iteration.
It is important to clear the candidates after the vote, so that we do not vote
repeatedly for same artifacts.</p>
<p>The voting functionality is done &#8220;under the hood&#8221; by some methods inherited
from <code class="xref py py-class docutils literal"><span class="pre">Environment</span></code> and <code class="xref py py-class docutils literal"><span class="pre">CreativeAgent</span></code>. However, it uses
the <code class="docutils literal"><span class="pre">evaluate</span></code> function which we defined for the agents (that&#8217;s why it is
important that it returns two values!). You can check what <code class="xref py py-meth docutils literal"><span class="pre">perform_voting()</span></code>
does from <a class="reference external" href="http://assamite.github.io/creamas/environment.html#creamas.core.environment.Environment.perform_voting">Creamas documentation</a>.</p>
</div>
<div class="section" id="running-the-simulation">
<h2>4.1.7. Running the Simulation<a class="headerlink" href="#running-the-simulation" title="Permalink to this headline">¶</a></h2>
<p>Lastly, we will run our agents in the iterative simulation. Here, we will
initialize all agents with the same parameters and run it for a short time:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;../week1/alice.txt&#39;</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">ToyEnvironment</span><span class="o">.</span><span class="n">create</span><span class="p">((</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">5555</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="n">ToyAgent</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

    <span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">log_folder</span><span class="o">=</span><span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">vote</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">async_steps</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</pre></div>
</div>
<p>We create environment using its <code class="docutils literal"><span class="pre">create</span></code> function, which needs the address
for it, and then create 10 agents into that environment. Then we initialize
our simulation with the environment, and set the callback (which is called after
each iteration) to our environment&#8217;s <code class="docutils literal"><span class="pre">vote</span></code> function. Lastly, we run the
simulation for 10 steps and end it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you do not remember to call <code class="docutils literal"><span class="pre">end</span></code> after finishing the simulation, you
will have some nasty exceptions because the event loop is still running!</p>
</div>
<p>That&#8217;s it! Now we have implemented a simple multi-agent system</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">CC-MAS 2016</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preliminaries.html">1. Preliminaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="course_format.html">2. Course Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="linguistic_creativity.html">3. Linguistic Creativity</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="mas.html">4. Multi-Agent Systems</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.1. Toy Example of MAS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parsing-the-vocabulary">4.1.1. Parsing the Vocabulary</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-an-agent-class">4.1.2. Creating an Agent Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-words">4.1.3. Generating words</a></li>
<li class="toctree-l3"><a class="reference internal" href="#evaluating-words">4.1.4. Evaluating Words</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inventing-new-words">4.1.5. Inventing New Words</a></li>
<li class="toctree-l3"><a class="reference internal" href="#voting">4.1.6. Voting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-simulation">4.1.7. Running the Simulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mas_memory.html">4.2. Agents with Memory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="assignments.html">5. Assignments</a></li>
<li class="toctree-l1"><a class="reference internal" href="zz_references.html">6. References</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="mas.html">4. Multi-Agent Systems</a><ul>
      <li>Previous: <a href="mas.html" title="previous chapter">4. Multi-Agent Systems</a></li>
      <li>Next: <a href="mas_memory.html" title="next chapter">4.2. Agents With Memory and Learning From Domain</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Simo Linkola.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.8</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/toy_mas.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>